## 流量预测模型说明

### 预测模型算法

| 镜像地址 |  |
| -------- | ------------------------------------------------------ |
| 网络配置 |                   |
| 启动命令 | docker-compose up                                 |
| 应用名称 | 预测模型算法                                           |

---
#### 接口信息

| 接口描述     | 心跳接口                      |
| ------------ | ----------------------------- |
| 方法名称     | ip:port/healthcheck.do |
| 接口类型     | HTTP-POST or  HTTP-GET 请求 body类型使用form-data        |
| 接口返回方式 | JSON                          |



#### 请求参数

无


#### 返回参数

```json
{"success": true, "msg": "心跳检测成功..."}
```

---

#### 接口信息
|接口描述| 文件上传 |
| ------------ | -------------------------- |
|方法名称| ip:port/upload_file|
|接口类型| HTTP-POST 请求|
#### 请求参数

```json
{"flow_file":文件}
```
#### 返回参数

```json
{"work_id": "ba5ba4e6-4264-43a9-b9bf-e390c59899fb",  "type" : "min", "file_url":
"static/upload/ba5ba4e6-4264-43a9-b9bf-e390c59899fb.csv", "ret": "6000"}
```

#### 错误码

|错误码|错误说明|
| ------------ | --------------------- |
|6000|正确|
|6001|文件上传key错误，必须用 file_url |
|6002|未知错误|



---

#### 接口信息

|接口描述| 延时型接口：通过文件上传告警数据（开启任务）|
| ------------ | -------------------------- |
| 方法名称| ip:port/get_flow|
| 接口类型| HTTP-POST 请求|
| 接口返回方式 | JSON|



#### 请求参数

```json
{"work_id": "9c2c9178-0ac9-4a22-bba9-8ebe4e92c2bb", "type":"min" , "is_train":"predict"}
```
work_id：上传文件成功时返回的的ID号。
type: 预测类型 取值包括：day/hour/min  默认为hour
is_train: 选择训练或预测  取值包括：train/predict  默认是train
说明：流量预测不同于一般静态模型预测，该类型预测需要连续数据，故第一次预测时需要将历史数据输入才可以预测
    如果再次预测 同类别同时间段的流量（例：已经训练过的贵阳流量，再次预测），可以将参数调整为predict，
    即加载之前的模型进行预测
    
    结果数据格式如下：day有7天 ， hour有24小时 ， min 有1小时（12个5分钟）
    遵义,202009270000:1375902.1,202009280000:1376755.9,202009290000:1376293.5,202009300000:1371201.9,202010010000:1363375.0,202010020000:1352915.9,202010030000:1346453.0,
    贵阳,202009270000:1684776.4,202009280000:1684750.1,202009290000:1683335.4,202009300000:1679222.4,202010010000:1672831.2,202010020000:1667174.9,202010030000:1663231.8,
    贵州,202009270000:9545495.0,202009280000:9543944.0,202009290000:9534251.0,202009300000:9515903.0,202010010000:9492163.0,202010020000:9461665.0,202010030000:9446050.0,


#### 返回参数

```json
{"ret": "4000", "work_id": "08ff0b1d-8959-4fd8-be8c-8828c8e7cca8",
"download_url": "static/download/08ff0b1d-8959-4fd8-be8c-8828c8e7cca8.csv"}
```

使用IP + 端口 + download_url 即可下载预测的流量


#### 参数描述
|参数名|是否必选|数据类型|描述|
| ------------ | -----|------|--------------- |
|ret|是|整型|返回码：4000表成功，其他表失败|
|work_id|否|字符串|用于一次任务的唯一标示，在取结果数据时作为入参传入。上传失败则没有该参数|
|download_url|否|字符串|用于对结果文件进行下载，需要等待处理结果达到100%后才能生效。上传失败则没有该参数|
#### 错误码
#### 错误码
|错误码|错误说明|
| ----|----- |
|4000|成功，任务开始启动|
|4001|没有告警文件url或url不合法|
|4002|服务器异常|
|4003|告警文件下载失败，或告警文件不符合要求|
|4004|请求方式错误，需要POST请求|

---                                         
#### 接口信息

| 接口描述|进度查询|
| ------------ | --------------------------- |
| 方法名称| ip:port/get_resu_process|
| 接口类型| HTTP-POST 请求|
| 接口返回方式 | JSON|



#### 请求参数

```json
{"work_id": "ba5ba4e6-4264-43a9-b9bf-e390c59899fb"}
```

#### 返回参数

```json
{"ret": "5000", "process": "100%"}
```
### 响应参数说明

|参数名|是否必选|数据类型|描述|
| --- | ------|-------|---|
|ret|是|字符型|返回码：5000表成功，其他表失败|
|process|是|字符型|任务处理进度|



#### 错误码

|错误码|错误说明|
| ------------ | --------------------- |
|5000|请求成功|
|5001|任务执行存在错误，不存在进度文件，重新上传开启任务|
|5002|请求方式错误，需要POST请求|
---

#### 接口信息
|接口描述| 结果文件下载 |
| ------------ | -------------------------- |
|方法名称| ip:port/get_download_resu|
|接口类型| HTTP-POST 请求|
#### 请求参数

```json
{"work_id":"48aaa2e8deaa3d4f27142445bfc36cd1"}
```
#### 返回结果

#### 错误码

|错误码|错误说明|
| ------------ | --------------------- |
|6001|workID错误|
|6002|请求方法错误|
|其他|正常则返回文件|



#### 接口信息
|接口描述| 删除上传和生成的文件 |
| ------------ | -------------------------- |
|方法名称| ip:port/remove_files|
|接口类型| HTTP-POST 请求|
#### 请求参数

无

#### 返回结果
文件名

#### 错误码

|错误码|错误说明|
| ------------ | --------------------- |
|201|请求方式错误|
|202|删除错误|
|其他|正常则返回文件|




#### 接口流程图
![Image text](https://s1.ax1x.com/2020/05/27/tkbkxP.png)

